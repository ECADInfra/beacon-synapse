version: 1
formatters:
    logfmt:
{% if include_worker_name_in_log_line %}
        format: 'ts=%(asctime)s worker={{ worker_name }} logger=%(name)s level=%(levelname)s request=%(request)s %(message)s'
{% else %}
        format: 'ts=%(asctime)s logger=%(name)s level=%(levelname)s request=%(request)s %(message)s'
{% endif %}
        datefmt: '%Y-%m-%dT%H:%M:%S'
filters:
    context:
        (): synapse.logging.context.LoggingContextFilter
        request: ""
handlers:
    console:
        class: logging.StreamHandler
        formatter: logfmt
        filters: [context]
{% if LOG_FILE_PATH %}
    file:
        class: logging.handlers.TimedRotatingFileHandler
        formatter: logfmt
        filters: [context]
        filename: {{ LOG_FILE_PATH }}
        when: midnight
        backupCount: 3
        encoding: utf8
{% endif %}
loggers:
    synapse.storage.SQL:
{% if SYNAPSE_LOG_SENSITIVE %}
        level: {{ SYNAPSE_LOG_LEVEL or "DEBUG" }}
{% else %}
        level: ERROR
{% endif %}

    # Beacon modules: auth, monitoring, info
    crypto_auth_provider:
        level: INFO
    beacon_monitor_module:
        level: INFO
    beacon_info_module:
        level: INFO

    # Synapse auth/login (failed logins, rate limiting)
    synapse.handlers.auth:
        level: WARNING
    synapse.rest.client.login:
        level: INFO

{% if SYNAPSE_LOG_TESTING %}
    synapse.handlers.typing:
        level: DEBUG
{% endif %}
root:
    level: {{ SYNAPSE_LOG_LEVEL or "ERROR" }}
    handlers:
        - console
{% if LOG_FILE_PATH %}
        - file
{% endif %}
disable_existing_loggers: false
